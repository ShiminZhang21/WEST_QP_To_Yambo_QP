The example shows how to convert WEST QP corrections
to Yambo ones and stored in SAVE/ndb.QP
using script qp_west2yambo.py and ypp program of Yambo.

The example contains the WEST QP corrections output files in directory qp_west,
the output file SAVE/ndb.QE and the intermediate file ypp.in.

It also contains the QE inputs scf.in and nscf.in, Yambo setup input init.in,
Yambo RPA inputs with/without QP corrections - rpa.in and rpa_qp.in
and Yambo RPA outputs r-rpa(_qp).* and o-rpa(_qp).*.


Notice that:
1. 
The python script works with python2.7 with package numpy.
Other python versions have not been tested.
2.
The k-point grids of the WEST GW calculation can be different from
the k grids of the Yambo BSE calculation.
Interpolation will be done automatically.
3.
For spin-polarized cases, 
ypp program must be recompiled with 
the modified source file $(YAMBO_DIR)/ypp/qp/QP_DBs_setup.F.
4.
It works for Yambo-4.1.4.
It is not sure whether it will work in later versions.
(For spin-unpolarized cases, probably it will work;
For spin-polarized cases, if $(YAMBO_DIR)/ypp/qp/QP_DBs_setup.F file 
is not updated after Yambo-4.1.4, probably it will still work.)


The following two steps are required to convert QP corrections:

1. Generate ypp input ypp.in:

    run "python qp_west2yambo.py -d $(WEST_DIR) -k $nk -s $ns"
    (e.g. "python qp_west2yambo.py -d ./qp_west -k 1 -s 2"),
    (please run "python qp_west2yambo.py -h" to get help information)

    it will generate ypp.in containing QP corrections
    of different bands at different k points and with different spins.

    For spin-polarized cases, QP corrections of spin-down states 
    will just below spin-up states in ypp.in file.

2. Generate ndb.QP:

    If you have ndb.gops, ndb.kindx, ns.db1 and ns.wf files in SAVE folder,
    running "$(YAMBO_DIR)/bin/ypp -F ypp.in"
    will generate SAVE/ndb.QP file.


After having SAVE/ndb.QP, adding
KfnQPdb= "E < ./SAVE/ndb.QP"
in Yambo RPA/BSE input, the WEST QP corrections are used in the BSE calculation.


Check: After having SAVE/ndb.QP,
            by running "ypp -q g", Yambo will generate a ypp.in file from SAVE/ndb.QP file,
            it can be seen that the new generated ypp.in is the same as 
            the one generated by qp_west2yambo.py from WEST output.